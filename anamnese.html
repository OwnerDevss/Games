<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ficha de Anamnese</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script>
    // Torna jsPDF acessível globalmente
    window.jsPDF = window.jspdf.jsPDF;
  </script>
</head>

<body class="bg-gray-100 p-6">
  <div class="max-w-6xl mx-auto bg-white p-8 rounded shadow">
    <h1 class="text-2xl font-bold mb-6 text-center">Ficha de Anamnese</h1>

    <!-- Botões para alternar os formulários -->
    <div class="flex space-x-4 mb-6">
      <button id="btnFacial" class="px-4 py-2 bg-blue-500 text-white rounded">Anamnese Facial</button>
      <button id="btnSobrancelha" class="px-4 py-2 bg-green-500 text-white rounded">Design de Sobrancelhas</button>
    </div>

    <!-- Formulário de Anamnese Facial -->
    <form id="formFacial" class="space-y-6">
      <h2 class="text-xl font-semibold">Dados Pessoais</h2>
      <div class="grid grid-cols-2 gap-4">
        <input id="nomeFacial" class="border p-2" type="text" placeholder="Nome">
        <input class="border p-2" type="text" placeholder="Endereço">
        <input class="border p-2" type="text" placeholder="Telefone Residencial">
        <input class="border p-2" type="text" placeholder="Telefone Celular">
        <input class="border p-2" type="email" placeholder="E-mail">
        <input class="border p-2" type="text" placeholder="Profissão">
      </div>
      <div class="grid grid-cols-4 gap-4">
        <input class="border p-2" type="number" placeholder="Idade">
        <select class="border p-2">
          <option>Sexo</option>
          <option>Feminino</option>
          <option>Masculino</option>
        </select>
        <input class="border p-2" type="text" placeholder="Nascimento">
        <input class="border p-2" type="text" placeholder="Estado Civil">
      </div>

      <h2 class="text-xl font-semibold">Análise da Pele</h2>
      <div class="grid grid-cols-3 gap-2">
        <label><input type="checkbox"> Comedão</label>
        <label><input type="checkbox"> Pústula</label>
        <label><input type="checkbox"> Queratose Actínica</label>
        <label><input type="checkbox"> Milium</label>
        <label><input type="checkbox"> Microcisto</label>
        <label><input type="checkbox"> Telangiectasia</label>
        <label><input type="checkbox"> Pápula</label>
        <label><input type="checkbox"> Nódulo</label>
        <label><input type="checkbox"> Outros</label>
      </div>

      <h2 class="text-xl font-semibold">Biotipo Cutâneo</h2>
      <div class="grid grid-cols-4 gap-2">
        <label><input type="radio" name="biotipo"> Normal</label>
        <label><input type="radio" name="biotipo"> Mista</label>
        <label><input type="radio" name="biotipo"> Lipídica</label>
        <label><input type="radio" name="biotipo"> Alípica</label>
      </div>

      <h2 class="text-xl font-semibold">Desequilíbrios e Outros</h2>
      <div class="grid grid-cols-3 gap-2">
        <label><input type="checkbox"> Pele Desidratada</label>
        <label><input type="checkbox"> Pele com Acne</label>
        <label><input type="checkbox"> Pele com Manchas</label>
        <label><input type="checkbox"> Pele Sensível</label>
        <label><input type="checkbox"> Acne Inflamatória</label>
        <label><input type="checkbox"> Manchas Espalhadas</label>
        <label><input type="checkbox"> Pele Reativa</label>
        <label><input type="checkbox"> Acne Não Inflamatória</label>
        <label><input type="checkbox"> Melasma</label>
      </div>

      <h2 class="text-xl font-semibold">Consentimento</h2>
      <p class="mb-4">As informações acima são expressão da verdade, não cabendo ao profissional nenhuma responsabilidade por fatos omitidos ou falsos.</p>
      <div class="flex space-x-4">
        <input class="border p-2 w-full" type="text" placeholder="Assinatura do Cliente">
        <input class="border p-2 w-full" type="text" placeholder="Assinatura do Profissional">
      </div>
    </form>

    <!-- Formulário de Design de Sobrancelhas -->
    <form id="formSobrancelha" class="space-y-6 hidden">
      <h2 class="text-xl font-semibold">Dados Pessoais</h2>
      <div class="grid grid-cols-2 gap-4">
        <input id="nomeSobrancelha" class="border p-2" type="text" placeholder="Nome">
        <input class="border p-2" type="text" placeholder="Data de Nascimento">
        <input class="border p-2" type="text" placeholder="RG">
        <input class="border p-2" type="text" placeholder="Telefone">
        <input class="border p-2" type="text" placeholder="Instagram">
        <input class="border p-2" type="text" placeholder="Endereço">
      </div>

      <h2 class="text-xl font-semibold">Histórico de Saúde</h2>
      <div class="space-y-2">
        <label><input type="checkbox" class="historicoSaude" data-question="Qual tipo de alergia?"> Alergia a cosméticos ou produtos químicos</label><br>
        <label><input type="checkbox" class="historicoSaude" data-question="Qual medicamento?"> Uso de medicamento contínuo</label><br>
        <label><input type="checkbox" class="historicoSaude" data-question="Qual doença de pele?"> Doenças de pele na região do rosto</label><br>
        <label><input type="checkbox" class="historicoSaude" data-question="Qual é o período gestacional?"> Gravidez ou amamentação</label><br>
        <label><input type="checkbox" class="historicoSaude" data-question="Qual tipo de problema?"> Diabetes ou problemas de cicatrização</label><br>
        <label><input type="checkbox" class="historicoSaude" data-question="Qual procedimento?"> Procedimento estético recente (botox, peeling, etc.)</label><br>
        <label><input type="checkbox" class="historicoSaude" data-question="Qual ácido?"> Uso de ácidos dermatológicos</label>
      </div>

      <div id="perguntasAdicionais" class="mt-4 space-y-4 hidden">
        <h3 class="text-lg font-semibold">Perguntas Adicionais</h3>
        <div id="perguntasContainer" class="space-y-2"></div>
      </div>

      <h2 class="text-xl font-semibold">Consentimento</h2>
      <p class="mb-4">Declaro que as informações acima são verdadeiras e estou ciente de que o profissional tomará os devidos cuidados para garantir um procedimento seguro.</p>
      <div class="flex space-x-4">
        <input class="border p-2 w-full" type="text" placeholder="Assinatura do Cliente">
        <input class="border p-2 w-full" type="text" placeholder="Assinatura do Profissional">
      </div>
    </form>

    <!-- Botão para salvar como PDF -->
    <div class="mt-8 text-center">
      <button onclick="gerarPDF()" class="px-6 py-2 bg-red-500 text-white rounded">Salvar como PDF</button>
    </div>
  </div>

  <!-- Script para alternar formulários e gerar PDF -->
  <script>
    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const formAtual = formFacial.classList.contains("hidden") ? formSobrancelha : formFacial;
      const nomeInput = formAtual.id === "formFacial" ? "nomeFacial" : "nomeSobrancelha";
      const nomeCliente = document.getElementById(nomeInput).value || "Sem_Nome";

      let y = 20;

      // Cabeçalho
      doc.setFontSize(18);
      const procedimento = formAtual.id === "formFacial" ? "Facial" : "Design de Sobrancelhas";
      doc.text(`Ficha de Anamnese - ${procedimento}`, 105, y, { align: "center" });

      y += 15;

      doc.setFontSize(12);
      if (formAtual.id === "formFacial") {
        y = await gerarFormularioFacial(doc, y);
      } else {
        y = await gerarFormularioSobrancelha(doc, y);
      }

      // Termo de consentimento
      y += 20;
      doc.setFontSize(14);
      doc.text("Termo de Consentimento", 15, y);
      y += 10;

      doc.setFontSize(11);
      const textoConsentimento = 
        "Declaro que as informações prestadas acima são verdadeiras. Estou ciente que " +
        "em caso de omissão ou informações falsas que resultem em risco para minha saúde " +
        "ou para a segurança do procedimento, o profissional não poderá ser responsabilizado, " +
        "e estou sujeito(a) a medidas legais cabíveis.";

      const lines = doc.splitTextToSize(textoConsentimento, 180);
      doc.text(lines, 15, y);
      y += lines.length * 10 + 20;

      // Espaço para assinaturas
      doc.line(30, y, 100, y); // linha para cliente
      doc.line(120, y, 190, y); // linha para profissional

      y += 5;
      doc.setFontSize(10);
      doc.text("Assinatura do Cliente", 45, y + 5);
      doc.text("Assinatura do Profissional", 135, y + 5);

      // Salvar o PDF
      doc.save(`Ficha_Anamnese_${nomeCliente}.pdf`);
    }

    async function gerarFormularioFacial(doc, y) {
      y += 10;
      doc.setFontSize(14);
      doc.text("Dados Pessoais", 15, y);
      y += 5;

      const dados = [];

      formFacial.querySelectorAll("input, select").forEach(input => {
        if (input.value && input.placeholder && input.placeholder !== "Sexo") {
          dados.push([input.placeholder, input.value]);
        } else if (input.tagName === "SELECT" && input.value !== "Sexo") {
          dados.push(["Sexo", input.value]);
        }
      });

      doc.autoTable({
        startY: y,
        head: [['Campo', 'Resposta']],
        body: dados,
        styles: { fontSize: 10 },
        margin: { left: 15, right: 15 },
      });

      y = doc.lastAutoTable.finalY + 10;

      doc.setFontSize(14);
      doc.text("Análise da Pele", 15, y);
      y += 5;

      const analisePele = [];
      formFacial.querySelectorAll("input[type=checkbox]").forEach(checkbox => {
        if (checkbox.checked) {
          analisePele.push(checkbox.parentNode.textContent.trim());
        }
      });

      if (analisePele.length > 0) {
        doc.autoTable({
          startY: y,
          body: analisePele.map(item => [item]),
          styles: { fontSize: 10 },
          margin: { left: 15, right: 15 },
        });
        y = doc.lastAutoTable.finalY + 10;
      }

      return y;
    }

    async function gerarFormularioSobrancelha(doc, y) {
      y += 10;
      doc.setFontSize(14);
      doc.text("Dados Pessoais", 15, y);
      y += 5;

      const dados = [];

      formSobrancelha.querySelectorAll("input").forEach(input => {
        if (input.value && input.placeholder && !input.closest('#perguntasContainer')) {
          dados.push([input.placeholder, input.value]);
        }
      });

      doc.autoTable({
        startY: y,
        head: [['Campo', 'Resposta']],
        body: dados,
        styles: { fontSize: 10 },
        margin: { left: 15, right: 15 },
      });

      y = doc.lastAutoTable.finalY + 10;

      doc.setFontSize(14);
      doc.text("Histórico de Saúde", 15, y);
      y += 5;

      const historico = [];
      formSobrancelha.querySelectorAll(".historicoSaude").forEach(checkbox => {
        if (checkbox.checked) {
          historico.push(checkbox.parentNode.textContent.trim());
        }
      });

      if (historico.length > 0) {
        doc.autoTable({
          startY: y,
          body: historico.map(item => [item]),
          styles: { fontSize: 10 },
          margin: { left: 15, right: 15 },
        });
        y = doc.lastAutoTable.finalY + 10;
      }

      // Perguntas adicionais
      const respostasAdicionais = [];
      formSobrancelha.querySelectorAll("#perguntasContainer input").forEach(input => {
        if (input.value) {
          respostasAdicionais.push([input.getAttribute("data-relacionado"), input.value]);
        }
      });

      if (respostasAdicionais.length > 0) {
        doc.setFontSize(14);
        doc.text("Detalhes Adicionais", 15, y);
        y += 5;

        doc.autoTable({
          startY: y,
          head: [["Pergunta", "Resposta"]],
          body: respostasAdicionais,
          styles: { fontSize: 10 },
          margin: { left: 15, right: 15 },
        });

        y = doc.lastAutoTable.finalY + 10;
      }

      return y;
    }

    // Alternar entre formulários
    document.getElementById('btnFacial').addEventListener('click', function() {
      document.getElementById('formFacial').classList.remove('hidden');
      document.getElementById('formSobrancelha').classList.add('hidden');
    });

    document.getElementById('btnSobrancelha').addEventListener('click', function() {
      document.getElementById('formFacial').classList.add('hidden');
      document.getElementById('formSobrancelha').classList.remove('hidden');
    });

    // Mostrar perguntas adicionais no Design de Sobrancelhas
    const historicos = document.querySelectorAll('.historicoSaude');
    const perguntasAdicionais = document.getElementById('perguntasAdicionais');
    const perguntasContainer = document.getElementById('perguntasContainer');

    historicos.forEach(input => {
      input.addEventListener('change', function() {
        perguntasContainer.innerHTML = '';

        historicos.forEach(historico => {
          if (historico.checked) {
            const label = document.createElement('label');
            label.classList.add('block');
            label.textContent = historico.getAttribute('data-question');

            const inputResposta = document.createElement('input');
            inputResposta.type = 'text';
            inputResposta.className = 'border p-2 w-full';
            inputResposta.placeholder = historico.getAttribute('data-question');
            inputResposta.setAttribute('data-relacionado', historico.parentNode.textContent.trim());

            perguntasContainer.appendChild(label);
            perguntasContainer.appendChild(inputResposta);
          }
        });

        if (perguntasContainer.children.length > 0) {
          perguntasAdicionais.classList.remove('hidden');
        } else {
          perguntasAdicionais.classList.add('hidden');
        }
      });
    });
</script>

</body>

</html>